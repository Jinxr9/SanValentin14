<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galaxia de San Valent√≠nüíóüåå</title>


    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Indie+Flower&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚ù§Ô∏è</text></svg>">
<link rel="preload" as="image" href="https://dl.dropboxusercontent.com/scl/fi/gfbim428ac1q71zyamlnk/log.webp?rlkey=00mkji2yiuq9xif3usmdrj7ut&st=kl29vn0j&raw=1">
<link rel="preload" as="image" href="https://dl.dropboxusercontent.com/scl/fi/delyd48mr1sylzs3qdqkt/card1.jpg?rlkey=156js3vvd17da355pxfyliib6&st=ol4fspc1&raw=1">
<link rel="preload" as="image" href="https://dl.dropboxusercontent.com/scl/fi/nn4tplgv8mtlh2ehcdfwg/card2.jpg?rlkey=74ybr7iiv4qecydpd9qmn2mzn&st=6lh62k1r&raw=1">
<link rel="preload" as="image" href="https://dl.dropboxusercontent.com/scl/fi/2ohu5mqrbwjnp9aqz9n7y/card3.jpg?rlkey=9k2au868ej93muc87bayvfrz5&st=06nbpd04&raw=1">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body {
            width: 100%; height: 100%;
            margin: 0; overflow: hidden;
            background-color: #000000;
            font-family: 'Indie Flower', cursive;
            cursor: grab;
            -webkit-user-select: none; user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        body:active { cursor: grabbing; }
        canvas { display: block; position: fixed; top: 0; left: 0; z-index: 1; }

        #main-title {
            position: absolute;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 4.5em;
            color: #FFB6C1;
            text-shadow: 0 0 15px #FF69B4, 0 0 25px #DC143C;
            z-index: 10;
            pointer-events: none;
            text-align: center;
            white-space: nowrap;
        }

        #start-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: black; display: flex; justify-content: center; align-items: center;
            flex-direction: column; color: white; z-index: 9999; padding: 20px;
        }
        
        #start-button-image {
            width: 150px;
            height: auto;
            cursor: pointer;
            filter: drop-shadow(0 0 15px #FF1493) drop-shadow(0 0 25px #FF0000);
            transition: all 0.3s ease;
            margin-bottom: 20px;
            animation: latido 1.5s infinite ease-in-out;
        }

        #start-button-image:hover {
            filter: drop-shadow(0 0 20px #FF69B4) drop-shadow(0 0 35px #FF1493);
            transform: scale(1.05);
        }
        
        @keyframes latido {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.08); }
        }

        #start-text {
            font-size: 1.8em;
            color: #FFB6C1;
            text-shadow: 0 0 10px #FF1493;
            text-align: center;
        }

        #love-card-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
            backdrop-filter: blur(5px);
            cursor: pointer;
        }

        #love-card {
            position: relative;
            width: 90%; max-width: 400px;
            aspect-ratio: 9 / 16;
            background-size: cover;
            background-position: center;
            border-radius: 20px;
            box-shadow: 0 0 30px #DC143C, 0 0 50px #FF1493;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 25px;
            text-align: center;
            overflow: hidden;
        }

        #love-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0, 0, 0, 0.4);
            z-index: 1;
        }

        #love-card-text {
            position: relative;
            font-size: 3em;
            color: #ffffff;
            text-shadow: 0 0 8px black, 0 0 15px black;
            z-index: 2;
        }

        @media (max-width: 768px) {
            #main-title { font-size: 3.4em; top: 25px; }
            #love-card-text { font-size: 2.8em; }
        }

        @media (max-width: 480px) {
            #main-title { font-size: 2.5em; top: 20px; }
        }
    </style>
</head>
<body>
    <h1 id="main-title">Feliz San Valent√≠n<br>popolita‚ù§Ô∏è</h1>

    <div id="start-screen">
    <img id="start-button-image" src="https://dl.dropboxusercontent.com/scl/fi/gfbim428ac1q71zyamlnk/log.webp?rlkey=00mkji2yiuq9xif3usmdrj7ut&st=kl29vn0j&raw=1" alt="Iniciar">        <div id="start-text">Toca para iniciar</div>
    </div>

    <div id="love-card-overlay">
        <div id="love-card">
            <p id="love-card-text"></p>
        </div>
    </div>

    <audio id="background-music" loop>
        <source src="https://dl.dropboxusercontent.com/scl/fi/kgo1eaoh44tpfbcq3ta4r/sound.mp3?rlkey=13dpol310dodn9r45rolm2nzp&st=30esvuy7&raw=1" type="audio/mpeg">
    </audio>

    <canvas id="galaxy-canvas"></canvas>

    <script type="importmap">
    { "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        } }
    </script>
    
    <script>
        document.addEventListener('contextmenu', event => event.preventDefault());
        document.onkeydown = function(e) {
            if (e.keyCode == 123 || (e.ctrlKey && e.shiftKey && (e.keyCode == 'I'.charCodeAt(0) || e.keyCode == 'J'.charCodeAt(0) || e.keyCode == 'C'.charCodeAt(0))) || (e.ctrlKey && (e.keyCode == 'U'.charCodeAt(0) || e.keyCode == 'S'.charCodeAt(0)))) {
                return false;
            }
        };
    </script>
    
    <script type="module">
        window.addEventListener("load", () => {
    init();
});
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
    import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
    import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
    import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';

    // ===================================================================
    // =============== M√ìDULO DE AJUSTES EDITABLE ========================
    // ===================================================================
    const CONFIG = {
        galaxy: { rotationSpeed: 0.12, centerExclusionRadius: 45 },
        elementExclusionRadius: 40,
        blackHole: { radius: 12, segments: 64, color1: '#000000', color2: '#050505' },
        
        accretionRing: {
            innerRadius: 18, outerRadius: 32, segments: 128,
            centerColor: '#FF69B4',
            midColor: '#FF1493',
            edgeColor: '#8B0000',
            emissiveIntensity: 1.9,
        },

        particles: {
            // === NUBE PRINCIPAL OVOIDE (plano ecuatorial, densa) ===
            coreStars: {
                count: 20000,        // m√°s part√≠culas totales
                radius: 120,
                maxHeight: 60,
                size: 0.25
            },

            // === CAPA SUPERIOR E INFERIOR ‚Äî forma esf√©rica achatada ===
            // Agrega part√≠culas fuera del plano para romper la planitud
            sphericalHalo: {
                count: 18000,        // part√≠culas del halo 3D
                radiusXZ: 110,       // radio en el plano horizontal
                radiusY: 55,         // radio vertical (achatado: < radiusXZ)
                size: 0.18,
                minDistFromCenter: 28
            },

            backgroundStars: { count: 5000, radius: 500, size: 0.2 },
            
            // === TEXTOS SAN VALENT√çN ===
            texts: {
                count: 50, width: 45, height: 20,
                minRadius: null, maxRadius: 120,
                content: [
                    "Feliz San Valent√≠n", "Te amo hoy y siempre popolita ‚ù§Ô∏è", "Eres mi corazoncito",
                    "Mi amor eterno", "Este d√≠a es tuyo", "Contigo lo es todo",
                    "Eres mi valent√≠n", "Un beso para ti", "Mi amor por ti no tiene limites! ‚ù§Ô∏è",
                    "Amor verdadero", "Mi hermosa mujer", "T√∫ eres mi hogar",
                    "14 de febrero", "Coraz√≥n m√≠o", "Eres lo que so√±√©",
                    "Siempre contigo", "ROMPIENDO DISTANCIAS, FRONTERAS, LIMITES", "Cada d√≠a te quiero m√°s",
                    "Eres mi mundo", "Solo t√∫ y yo"
, "27/08/25 ‚ù§Ô∏è", "27", "27/08/25 ‚ù§Ô∏è", "TE AMO POPOLA‚ù§Ô∏è", "POPOLO TE AMA DEMASIADO!‚ù§Ô∏è"
                ],
                colors: [
                    { fill: '#FF69B4', shadow: '#FF1493' },
                    { fill: '#FFB6C1', shadow: '#DC143C' },
                    { fill: '#FFC0CB', shadow: '#FF69B4' }
                ]
            },
            images: {
                count: 50, size: 12,
                minRadius: null, maxRadius: 120,
            urls: [ 
                'https://dl.dropboxusercontent.com/scl/fi/07lqextmf3ae6g7ihipsl/img1.gif?rlkey=ncnihs3zzqlwyjnwdxbs9je04&st=9dazhxpg&raw=1', 
                'https://dl.dropboxusercontent.com/scl/fi/ibnyxqdqafhv705wgctzm/img2.png?rlkey=t8sholdyg9ca4c61tyi5wnpjn&st=8kibpf9a&raw=1', 
                'https://dl.dropboxusercontent.com/scl/fi/06rmjf457tjqlzrvxrd8z/img3.png?rlkey=my0hs6l0yqm9876txolf4geo4&st=07imfsey&raw=1', 
                'https://dl.dropboxusercontent.com/scl/fi/ugr4ftcvi7t9675d8c4kr/img4.png?rlkey=snur82qbg4qx49taucf96oo97&st=i2qztukc&raw=1', 
                'https://dl.dropboxusercontent.com/scl/fi/gw7gtnpcs3prw47ojw5mx/img5.png?rlkey=kzn9psxo3ipd8v2v5r15qe36x&st=un71twed&raw=1'
            ]            }
        },

        loveCards: {
                // URLs actualizadas a dl.dropboxusercontent.com
                images: [ 
                    'https://dl.dropboxusercontent.com/scl/fi/delyd48mr1sylzs3qdqkt/card1.jpg?rlkey=156js3vvd17da355pxfyliib6&st=ol4fspc1&raw=1', 
                    'https://dl.dropboxusercontent.com/scl/fi/nn4tplgv8mtlh2ehcdfwg/card2.jpg?rlkey=74ybr7iiv4qecydpd9qmn2mzn&st=6lh62k1r&raw=1', 
                    'https://dl.dropboxusercontent.com/scl/fi/2ohu5mqrbwjnp9aqz9n7y/card3.jpg?rlkey=9k2au868ej93muc87bayvfrz5&st=06nbpd04&raw=1' 
                ],
                phrases: [
                    "TE AMO LUCIA‚ù§Ô∏è Feliz San Valent√≠n mi amor, Eres la raz√≥n de mi sonrisa cada d√≠a‚ù§Ô∏è",
                    "En este San Valent√≠n y en todos los que vengan quiero permanecer a tu lado‚ù§Ô∏è",
                    "Mi galaxia entera gira alrededor de ti mi vida, Eres el sue√±o m√°s bonito que se volvi√≥ realidad‚ù§Ô∏è",
                    "Eres el sue√±o m√°s bonito que se volvi√≥ realidad.",
                    "TE AMO LUCIA‚ù§Ô∏è Feliz San Valent√≠n"
                ]
            },

        shootingStars: {
            enabled: true,
            spawnProbability: 0.01,
            speed: 1.2
        },
        lighting: {
            ambientLight: { color: '#ffffff', intensity: 0.1 },
            pointLight: { color: '#FF69B4', intensity: 2.5, distance: 350 }
        },
        bloomEffect: { threshold: 0.68, strength: 1.5, radius: 0.5 },
        cameraControls: { minDistance: 30, maxDistance: 250 }
    };
    // ===================================================================

    let scene, camera, renderer, controls, galaxyGroup, clock, sphereMaterial, composer;
    let loveTexts = [], loveImages = [], shootingStars = [];
    let occupiedPositions = [];
    let raycaster, mouse;
    let currentCardIndex = 0;

    function init() {
        scene = new THREE.Scene();
        clock = new THREE.Clock();
        raycaster = new THREE.Raycaster();
        mouse = new THREE.Vector2();

        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('galaxy-canvas'), antialias: true });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);

        controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true; controls.dampingFactor = 0.05;
        controls.minDistance = CONFIG.cameraControls.minDistance;
        controls.maxDistance = CONFIG.cameraControls.maxDistance;

        const renderScene = new RenderPass(scene, camera);
        const bloomPass = new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.5, 0.4, 0.85);
        bloomPass.threshold = CONFIG.bloomEffect.threshold;
        bloomPass.strength = CONFIG.bloomEffect.strength;
        bloomPass.radius = CONFIG.bloomEffect.radius;
        composer = new EffectComposer(renderer);
        composer.addPass(renderScene);
        composer.addPass(bloomPass);

        const { ambientLight, pointLight } = CONFIG.lighting;
        scene.add(new THREE.AmbientLight(ambientLight.color, ambientLight.intensity));
        const mainLight = new THREE.PointLight(pointLight.color, pointLight.intensity, pointLight.distance);
        mainLight.position.set(0, 0, 0);
        scene.add(mainLight);
        
        galaxyGroup = new THREE.Group();
        scene.add(galaxyGroup);

        createBlackHole();
        createCoreStars();
        createSphericalHalo();     // ‚Üê NUEVO: capa 3D ovoide
        createBackgroundStars();
        createLoveElements();

        window.addEventListener('resize', onWindowResize);
        renderer.domElement.addEventListener('click', onCanvasClick);
        onWindowResize();
        animate();
    }
    
    function createBlackHole() {
        const bhConfig = CONFIG.blackHole;
        const ringConfig = CONFIG.accretionRing;
        sphereMaterial = new THREE.ShaderMaterial({
            uniforms: { uTime: { value: 0.0 }, uColor1: { value: new THREE.Color(bhConfig.color1) }, uColor2: { value: new THREE.Color(bhConfig.color2) } },
            vertexShader: `varying vec2 vUv; void main() { vUv = uv; gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); }`,
            fragmentShader: `uniform float uTime; uniform vec3 uColor1; uniform vec3 uColor2; varying vec2 vUv; float noise(vec2 st) { return fract(sin(dot(st.xy, vec2(12.9898, 78.233))) * 43758.5453123); } void main() { float n = noise(vUv * 4.0 + uTime * 0.1); vec3 mixedColor = mix(uColor1, uColor2, n); gl_FragColor = vec4(mixedColor, 1.0); }`
        });
        scene.add(new THREE.Mesh(new THREE.SphereGeometry(bhConfig.radius, bhConfig.segments, bhConfig.segments), sphereMaterial));
        const ringGeometry = new THREE.RingGeometry(ringConfig.innerRadius, ringConfig.outerRadius, ringConfig.segments);
        const ringMaterial = new THREE.ShaderMaterial({
            uniforms: { innerRadius: { value: ringConfig.innerRadius }, outerRadius: { value: ringConfig.outerRadius }, centerColor: { value: new THREE.Color(ringConfig.centerColor) }, midColor: { value: new THREE.Color(ringConfig.midColor) }, edgeColor: { value: new THREE.Color(ringConfig.edgeColor) }, emissiveIntensity: { value: ringConfig.emissiveIntensity } },
            vertexShader: `varying vec3 vPosition; void main() { vPosition = position; gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); }`,
            fragmentShader: `uniform float innerRadius; uniform float outerRadius; uniform vec3 centerColor; uniform vec3 midColor; uniform vec3 edgeColor; uniform float emissiveIntensity; varying vec3 vPosition; void main() { float distance = length(vPosition.xy); float normalizedDistance = clamp((distance - innerRadius) / (outerRadius - innerRadius), 0.0, 1.0); vec3 finalColor; if (normalizedDistance < 0.5) { finalColor = mix(centerColor, midColor, normalizedDistance * 2.0); } else { finalColor = mix(midColor, edgeColor, (normalizedDistance - 0.5) * 2.0); } float glowFactor = 1.0 - smoothstep(0.0, 1.0, normalizedDistance); vec3 emissiveColor = finalColor * emissiveIntensity * glowFactor; gl_FragColor = vec4(finalColor + emissiveColor, 1.0); }`,
            side: THREE.DoubleSide
        });
        const goldenRing = new THREE.Mesh(ringGeometry, ringMaterial);
        goldenRing.rotation.x = Math.PI / 2;
        scene.add(goldenRing);
    }

    // ====== CAPA ECUATORIAL ORIGINAL (mantenida intacta) ======
    function createCoreStars() {
        const coreConfig = CONFIG.particles.coreStars;
        const geometry = new THREE.BufferGeometry();
        const positions = new Float32Array(coreConfig.count * 3);
        const colors = new Float32Array(coreConfig.count * 3);
        const color = new THREE.Color();
        for (let i = 0; i < coreConfig.count; i++) {
            const distance = CONFIG.accretionRing.outerRadius + Math.random() * (coreConfig.radius - CONFIG.accretionRing.outerRadius);
            const angle = Math.random() * Math.PI * 2;
            const y = (Math.random() - 0.5) * coreConfig.maxHeight * Math.pow(1 - (distance / coreConfig.radius), 1.5);
            positions.set([Math.cos(angle) * distance, y, Math.sin(angle) * distance], i * 3);
            
            const hue = 0.9 + Math.random() * 0.15;
            const saturation = 0.8 + Math.random() * 0.2;
            const lightness = 0.6 + Math.random() * 0.4;
            color.setHSL(hue % 1, saturation, lightness);
            colors.set([color.r, color.g, color.b], i * 3);
        }
        geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
        geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
        const material = new THREE.PointsMaterial({ size: coreConfig.size, blending: THREE.AdditiveBlending, vertexColors: true, transparent: true });
        galaxyGroup.add(new THREE.Points(geometry, material));
    }

    // ====== NUEVA CAPA: HALO ESFEROIDAL ACHATADO ======
    // Distribuye part√≠culas en un elipsoide (achatado verticalmente)
    // que cubre uniformemente el volumen superior e inferior de la galaxia,
    // haciendo que la nube se vea redondeada/ovoide y no plana.
    function createSphericalHalo() {
        const haloConfig = CONFIG.particles.sphericalHalo;
        const geometry = new THREE.BufferGeometry();
        const positions = new Float32Array(haloConfig.count * 3);
        const colors = new Float32Array(haloConfig.count * 3);
        const color = new THREE.Color();

        let filled = 0;
        while (filled < haloConfig.count) {
            // Muestra aleatoria uniforme dentro de un elipsoide usando rechazo
            const rx = (Math.random() * 2 - 1);
            const ry = (Math.random() * 2 - 1);
            const rz = (Math.random() * 2 - 1);

            // Coordenadas en espacio elipsoidal normalizado
            // Si rx¬≤+ry¬≤+rz¬≤ > 1, el punto cae fuera del elipsoide ‚Üí rechazar
            if (rx * rx + ry * ry + rz * rz > 1.0) continue;

            const x = rx * haloConfig.radiusXZ;
            const y = ry * haloConfig.radiusY;
            const z = rz * haloConfig.radiusXZ;

            // Excluir la zona central (esfera de exclusi√≥n)
            const distFromCenter = Math.sqrt(x * x + y * y + z * z);
            if (dist
